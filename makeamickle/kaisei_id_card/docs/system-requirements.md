# デジタル学生証システム 統合要件定義書

## 1. システム概要

### 1.1 目的
本システムは、某中高一貫校における紙の生徒証をデジタル化し、生徒の利便性向上と管理業務の効率化を実現する。また、卒業後も母校との接点を維持するためのコミュニケーション基盤として機能する。

### 1.2 システム構成
- **生徒用モバイルアプリケーション**（iOS/Android/iPadOS対応）
- **教職員用Web管理システム**（PCブラウザ対応）
- **バックエンドAPI**（クラウドベース）
- **データベース**（生徒情報、認証情報、通知情報）
- **外部連携システム**（図書館システム、学校ホームページ）

### 1.3 対象ユーザー
| ユーザー種別 | 人数規模 | 主な利用機能 | アクセス権限 |
|------------|---------|------------|------------|
| 在校生 | 約750名 | 生徒証表示、図書館利用、個人情報確認 | 自己情報の参照のみ |
| 卒業生 | 約10,000名 | 通知受信、個人情報更新 | 自己情報の参照・一部更新 |
| システム管理者 | 2-3名 | システム設定、ユーザー管理、監査 | 全権限 |
| 事務職員 | 約5名 | 生徒情報管理、一括処理 | 生徒情報の編集権限 |

## 2. 機能要件

### 2.1 生徒用アプリケーション機能

#### 2.1.1 認証機能（Firebase Authentication）
- **初回登録フロー**
  - 学校から配布される個別アクティベーションコードで認証開始
  - メールアドレスまたは電話番号を登録
  - Firebase Authenticationでアカウント作成
  - 以降はメールリンク認証または電話番号認証（SMS認証）
- **生体認証との連携**（Face ID/Touch ID/指紋認証）※対応端末のみ
- **端末管理**
  - Firebase Auth のカスタムクレームで端末制御
  - 最大2台までの端末登録（在校生）
  - 卒業生は1台のみ
  - 端末の追加・削除・一覧表示
  - 紛失時のリモート無効化

#### 2.1.2 生徒証表示機能
- **基本情報表示**
  - 顔写真（必須）
  - 氏名（漢字・ふりがな）
  - 学年・クラス
  - 学籍番号
  - 有効期限
  - 校長印（デジタル署名付き）
- **図書館バーコード**
  - Code128形式
  - オフライン表示対応
  - 明るさ自動調整機能
- **セキュリティ機能**
  - スクリーンショット防止（iOS）
  - 一定時間後の自動ロック
  - なりすまし防止用QRコード（30秒ごとに更新）

#### 2.1.3 通知機能（卒業生のみ）
- **Firebase Cloud Messaging（FCM）使用**
- **卒業生向け通知**
  - 同窓会情報
  - 学校ニュース（RSS連携）
  - 寄付のお願い等
- **通知設定**
  - カテゴリー別のON/OFF
  - 通知時間帯設定
  - 既読管理
- **注意**: 在校生への通知機能は実装しない

#### 2.1.4 個人情報管理
- **在校生**：参照のみ（変更は管理者経由）
- **卒業生**：以下の項目を自己更新可能
  - 連絡先（住所、電話番号、メールアドレス）
  - 勤務先情報
  - 通知設定

### 2.2 教職員用Web管理システム機能

#### 2.2.1 システム管理機能（システム管理者のみ）
- **ユーザー管理**
  - 教職員アカウントの新規作成
  - 作成時に役割（システム管理者/事務職員）を選択
  - アカウントの有効化・無効化
  - パスワードリセット
- **システム設定**
  - 学校基本情報の設定
  - 年度情報の管理
  - 校長印の登録・更新
  - バックアップ・リストア

#### 2.2.2 生徒情報管理機能（事務職員）
- **個別管理**
  - 生徒情報の新規登録・編集・削除
  - 顔写真のアップロード（JPEG/PNG、最大5MB）
  - 生徒証の発行・再発行・無効化
  - 端末登録状況の確認・強制解除
- **一括管理**
  - CSV形式での一括登録・更新
  - エラーレポート出力
  - 差分確認機能
- **アクティベーションコード管理**
  - コードの発行・再発行
  - 印刷用PDF生成
  - 使用状況の確認

#### 2.2.2 年次処理機能
- **入学処理**
  - 新入生データの一括登録
  - 学籍番号の自動採番
  - 初期パスワードの生成と通知
- **昇級処理**
  - 全生徒の学年・クラス一括更新
  - 留年・休学生徒の個別対応
  - 処理前プレビュー機能
- **卒業処理**
  - 卒業生ステータスへの変更
  - アクセス権限の切り替え
  - 卒業証書番号の記録
- **除籍処理**
  - 退学・転校生徒の処理
  - データのアーカイブ
  - アクセス権の即時停止

#### 2.2.3 通知管理
- **通知作成・配信**
  - リッチテキストエディタ
  - 画像添付機能（最大3枚）
  - 配信対象の詳細設定
  - 予約配信
- **配信履歴管理**
  - 配信状況の確認
  - 開封率の統計
  - 再送機能

#### 2.2.4 システム管理機能
- **ユーザー管理**
  - 教職員アカウントの管理
  - 役割ベースのアクセス制御（RBAC）
  - 操作ログの記録と監査
- **マスタデータ管理**
  - 学年・クラス設定
  - 年度情報
  - 校長印の登録・更新
- **バックアップ・リストア**
  - 自動バックアップ設定
  - 手動バックアップ実行
  - リストア機能

## 3. 非機能要件

### 3.1 性能要件
| 項目 | 要件値 | 測定条件 |
|-----|--------|---------|
| 生徒証表示時間 | 1秒以内 | アプリ起動後、キャッシュありの状態 |
| 同時接続数 | 1,000ユーザー | ピーク時（朝8:00-8:30） |
| API応答時間 | 平均200ms以内 | 通常のCRUD操作 |
| 一括処理 | 1,000件/分 | CSV一括登録時 |

### 3.2 セキュリティ要件
- **データ保護**
  - 通信の暗号化（TLS 1.3以上）
  - データベース暗号化（AES-256）
  - 個人情報のマスキング表示
- **アクセス制御**
  - JWT方式の認証トークン
  - トークン有効期限：7日間（更新可能）
  - IPアドレス制限（管理画面）- adminsコレクションのallowedIPsフィールドで制御
- **監査**
  - 全操作のログ記録
  - ログの改ざん防止
  - 90日間の保存

### 3.3 可用性要件
- **稼働率**：99.5%以上（計画停止を除く）
- **RPO**（目標復旧時点）：1時間
- **RTO**（目標復旧時間）：4時間
- **メンテナンス時間**：毎月第3日曜日 2:00-5:00

### 3.4 拡張性要件
- **スケーラビリティ**
  - ユーザー数10,000名まで対応
  - 水平スケーリング可能な設計
- **外部連携**
  - REST API による連携
  - Webhook対応
  - 認証連携（SAML/OAuth2.0）

### 3.5 運用性要件
- **監視**
  - リアルタイム監視
  - アラート通知（メール/Slack）
  - ダッシュボード提供
- **保守**
  - リモート保守対応
  - 自動アップデート機能
  - ロールバック機能

## 4. 制約事項

### 4.1 技術的制約
- **対応OS**
  - iOS 14.0以上
  - iPadOS 14.0以上
  - Android 8.0以上
  - Chrome/Safari/Edge最新版（管理画面）
- **開発フレームワーク**
  - モバイル：Flutter 3.0以上（iOS/iPadOS/Android共通）
  - バックエンド：Firebase (Cloud Functions - Node.js 18)
  - 管理画面：Next.js 14.0+ / React 18.0+ / TypeScript 5.0+
  - 認証：Firebase Authentication
  - 通知：Firebase Cloud Messaging（FCM）
- **アプリ配布**
  - iOS/iPadOS：App Store
  - Android：Google Play Store
  - 各プラットフォーム向けのビルド自動化（Fastlane使用）

### 4.2 法的制約
- **個人情報保護法準拠**
  - 利用目的の明示
  - 第三者提供の制限
  - 開示請求への対応
- **著作権**
  - 校長印のデジタル化許諾
  - 生徒写真の利用許諾

### 4.3 運用制約
- **データ保存期間**
  - 在校生：無期限
  - 卒業生：卒業後10年
  - 除籍者：除籍後5年
- **利用時間**
  - 24時間365日（メンテナンス時を除く）

## 5. 前提条件

### 5.1 既存システム連携
- 図書館システム（バーコード連携）
- 学校ホームページ（RSS配信）
- 生徒情報システム（初期データ移行）

### 5.2 運用体制
- システム管理者の設置（情報担当教員）
- ヘルプデスクの設置
- 運用マニュアルの整備

### 5.3 移行計画
- 段階的導入（学年単位）
- 個別アクティベーションコードの印刷・配布
- 初回登録説明会の実施
- 並行運用期間：3ヶ月
- 紙の生徒証との併用期間設定

## 6. 用語定義

| 用語 | 定義 |
|-----|-----|
| 生徒証 | 本システムで発行・管理されるデジタル形式の身分証明書 |
| 学籍番号 | 生徒を一意に識別する番号（入学時に付与） |
| 除籍 | 退学・転校により在籍を失うこと |
| OTP | One Time Password（ワンタイムパスワード） |
| RBAC | Role Based Access Control（役割ベースのアクセス制御） |

## 7. 改訂履歴

| 版数 | 日付 | 改訂内容 | 作成者 |
|-----|-----|---------|--------|
| 1.0 | 2024/01/15 | 初版作成 | システム企画担当 |